{% extends "dashboard_base.html" %}
{% load currency %}
{% load static %}

{% block title %}Islington Marketplace - Order Tracking #{{ object.uuid }}{% endblock %}

{% block dashboard_content %}
    <div class="bg-[var(--clr-warning-50)] border border-[var(--clr-warning-200)] p-6 flex justify-between items-center">
        <div>
            <h1 class="text-[var(--clr-gray-900)] text-xl mb-2">#{{ object.uuid }}</h1>
            <p class="text-[var(--clr-gray-700)] flex items-center gap-2">
                {{ products|length }} Products <span>.</span> Order Placed in {{ object.created }}
            </p>
        </div>

        <span class="text-[var(--clr-secondary-500)] font-semibold text-3xl">{{ order.total_amount|nepali_currency }}</span>
    </div>

    <p class="text-sm text-[var(--clr-gray-700)] my-6">Order Expected arrival <span class="text-[var(--clr-gray-900)]">23 Aug, 2025</span>
    </p>

    <div class="text-[var(--clr-gray-900)]">
        <div class="relative">
            <div class="absolute top-6 left-0 w-full h-2 bg-gray-300 rounded"></div>
            <div class="absolute top-6 left-0 h-2 bg-green-500 rounded"
                 style="width: {{ progress_percent }}%;"></div>

            <div class="flex justify-between relative z-10">
                {% for step in steps %}
                    <div class="flex flex-col items-center w-1/4">
                        <!-- Marker -->
                        {% if step.completed %}
                            <div class="w-8 h-8 flex items-center justify-center bg-green-500 text-white rounded-full border-2 border-white">
                                ✔
                            </div>
                        {% else %}
                            <div class="w-8 h-8 flex items-center justify-center bg-gray-300 text-white rounded-full border-2 border-white">
                                ⭕
                            </div>
                        {% endif %}

                        <p class="text-sm mt-2 text-gray-700 font-medium text-center">{{ step.label }}</p>

                        {% if step.timestamp %}
                            <p class="text-xs text-gray-500 text-center">{{ step.timestamp|date:"M d, Y H:i" }}</p>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <div class="mt-12">
        <h3 class="text-lg font-semibold mb-4 text-gray-800">Activity Log</h3>
        <ul class="divide-y divide-gray-200">
            {% for log in logs %}
                <li class="py-4 flex flex-col sm:flex-row gap-3 items-center sm:items-center">
                    <div class="flex items-center gap-3">
                        <!-- Status marker -->
                        <div class="w-4 h-4 rounded-full
            {% if log.status == 'delivered' %}
                bg-green-500
            {% elif log.status == 'shipped' %}
                bg-blue-500
            {% else %}
                bg-gray-400
            {% endif %}"></div>

                        <!-- Status label -->
                        <span class="font-medium text-gray-700">{{ log.get_status_display }}</span>
                    </div>

                    <!-- Timestamp -->
                    <span class="text-xs text-gray-500 mt-1 sm:mt-0">
                    {{ log.timestamp|date:"M d, Y H:i" }}
                  </span>

                    <!-- Optional note -->
                    {% if log.note %}
                        <p class="text-sm text-gray-500 ml-7 sm:ml-0 mt-1">{{ log.note }}</p>
                    {% endif %}
                </li>
            {% empty %}
                <li class="py-4 text-gray-400">No activity yet.</li>
            {% endfor %}
        </ul>
    </div>
{% endblock %}